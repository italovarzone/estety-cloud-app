<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lash App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="../assets/icons/favicon.ico" rel="favicon"/>
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            background-color: azure;
        }

        .wrapper {
            display: flex;
            height: 100%;
            position: relative;
            z-index: 1;
        }

        .sidebar {
            width: 250px;
            background-color: #c378dc;
            color: white;
            padding-top: 20px;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .sidebar.minimized {
            width: 60px;
            align-items: center;
        }

        .sidebar a, .module-btn {
            color: white;
            padding: 15px;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            font-size: 16px;
            transition: all 0.3s ease;
            width: 100%;
            border: none;
            background: none;
            cursor: pointer;
        }

        .sidebar.minimized a, .sidebar.minimized .module-btn {
            justify-content: center;
        }

        .sidebar a i, .module-btn i {
            margin-right: 10px;
            font-size: 20px;
        }

        .sidebar.minimized a i, .sidebar.minimized .module-btn i {
            margin: 0;
        }

        .sidebar.minimized a span, .sidebar.minimized .module-btn span {
            display: none;
        }

        .content {
            flex: 1;
            padding: 0;
            transition: all 0.3s ease;
            background-color: rgba(255, 255, 255, 0.8);
        }

        .content iframe {
            width: 100%;
            height: 100%;
            border: none;
            background-color: transparent;
        }

        .floating-menu {
            position: absolute;
            width: 200px;
            background-color: white;
            border: 1px solid #ddd;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 1001;
        }

        .floating-menu a {
            display: flex;
            align-items: center;
            padding: 10px;
            color: #333;
            text-decoration: none;
            border-bottom: 1px solid #ddd;
        }

        .floating-menu a i {
            margin-right: 10px;
        }

        .floating-menu a:hover {
            background-color: #f5f5f5;
        }

        .sidebar .module-btn:hover, .sidebar a:hover {
            background-color: #9c5fb1;
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between; /* Ajustado para exibir conteúdo */
            align-items: center;
            padding: 10px;
        }

        .toggle-btn {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 24px;
            background-color: transparent;
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sidebar.minimized .toggle-btn span {
            display: none; /* Esconde o texto quando minimizada */
        }

        .sidebar-logout {
            display: flex;
            justify-content: center;
            margin-top: auto;
            padding: 10px 15px;
            text-align: center;
            background-color: #d42c19;
            width: 100%; /* Ocupa toda a largura */
        }

        .sidebar-logout a {
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
        }

        .sidebar-logout a i {
            margin-right: 10px;
        }

        .sidebar.minimized .sidebar-logout a i {
            margin: 0;
        }

        .sidebar.minimized .sidebar-logout a span {
            display: none;
        }

        .sidebar-logout a:hover {
            background-color: #9a534b !important;
        }

        @media (max-width: 767px) {
            .sidebar {
                width: 60px; /* Sempre minimizada */
                height: 100%;
                overflow-y: auto;
                z-index: 1000;
            }

            .content {
                width: 100%;
                padding: 15px;
            }

            .floating-menu {
                left: 70%;
            }

            .toggle-btn {
                pointer-events: none; /* Desativa o botão de toggle */
                opacity: 0.5; /* Visualmente indica que está desativado */
            }
        }
    </style>
</head>
<body>
<div class="wrapper">
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <button class="toggle-btn" id="toggle-btn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        <!-- Módulos -->
        <button class="module-btn" data-module="clientes"><i class="fas fa-users"></i><span>Clientes</span></button>
        <button class="module-btn" data-module="agendamentos"><i class="fas fa-calendar-alt"></i><span>Agendamentos</span></button>
        <button class="module-btn" data-module="procedimentos"><i class="fas fa-tools"></i><span>Procedimentos</span></button>
        <button class="module-btn" data-module="extras"><i class="fas fa-plus-circle"></i><span>Extras</span></button>
        <button class="module-btn" data-module="opcoes"><i class="fas fa-cog"></i><span>Opções</span></button>
    </div>

    <!-- Menu Flutuante -->
    <div class="floating-menu" id="floating-menu">
        <!-- Funcionalidades serão adicionadas dinamicamente aqui -->
    </div>

    <div class="content expanded">
        <iframe name="content-frame" id="content-frame" src="pages/agendamentos/listagem.html"></iframe>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
const toggleBtn = document.getElementById('toggle-btn');
const sidebar = document.getElementById('sidebar');
const content = document.querySelector('.content');
const floatingMenu = document.getElementById('floating-menu');
const moduleButtons = document.querySelectorAll('.module-btn');
let currentOpenModule = null; // Track the currently open module

// Verifica a largura da tela ao carregar a página e ajusta a sidebar
function checkScreenWidth() {
    if (window.innerWidth <= 768) {
        sidebar.classList.add('minimized');
        content.classList.add('expanded');
        localStorage.setItem('sidebarState', 'minimized');
        toggleBtn.style.pointerEvents = 'none'; // Desativa o botão de toggle
        toggleBtn.style.opacity = '0.5'; // Indica visualmente que o botão está desativado
    } else {
        sidebar.classList.remove('minimized');
        content.classList.remove('expanded');
        localStorage.setItem('sidebarState', 'expanded');
        toggleBtn.style.pointerEvents = 'auto'; // Ativa o botão de toggle
        toggleBtn.style.opacity = '1'; // Remove a opacidade reduzida
    }
}

// Executa a função ao carregar a página
checkScreenWidth();

// Ajusta a sidebar quando a janela é redimensionada
window.addEventListener('resize', checkScreenWidth);

// Alterna a barra lateral entre minimizada e expandida
toggleBtn.addEventListener('click', function () {
    if (window.innerWidth > 768) { // Permite apenas se a tela for maior que 768px
        sidebar.classList.toggle('minimized');
        content.classList.toggle('expanded');
        adjustFloatingMenuPosition(); // Ajusta a posição do menu flutuante conforme o estado da sidebar

        // Salva o estado da sidebar no localStorage
        if (sidebar.classList.contains('minimized')) {
            localStorage.setItem('sidebarState', 'minimized');
        } else {
            localStorage.setItem('sidebarState', 'expanded');
        }
    }
});

// Abre o menu flutuante com as opções do módulo
moduleButtons.forEach(button => {
    button.addEventListener('click', function (event) {
        event.stopPropagation(); // Impede o clique de ser propagado
        const module = this.getAttribute('data-module');
        
        // Verifica se o menu já está aberto para o módulo atual
        if (currentOpenModule === module) {
            closeFloatingMenu(); // Fecha o menu se o botão for clicado novamente
            return;
        }
        
        showFloatingMenu(module, this); // Passa o botão clicado para posicionamento
        currentOpenModule = module; // Define o módulo atual como aberto
    });
});

// Função para ajustar a posição do menu flutuante
function adjustFloatingMenuPosition() {
    if (sidebar.classList.contains('minimized')) {
        floatingMenu.style.left = '60px'; // Alinhamento para a sidebar minimizada
    } else {
        floatingMenu.style.left = '250px'; // Alinhamento para a sidebar expandida
    }
}

// Função para exibir o menu flutuante
function showFloatingMenu(module, buttonElement) {
    adjustFloatingMenuPosition();
    
    // Calcula a posição vertical do botão clicado
    const buttonRect = buttonElement.getBoundingClientRect();
    floatingMenu.style.top = `${buttonRect.top}px`; // Alinha o topo do menu ao botão

    floatingMenu.style.display = 'block';
    floatingMenu.innerHTML = ''; // Limpa o conteúdo anterior
    let menuItems = [];
    
    // Define as opções de menu com base no módulo selecionado
    switch (module) {
        case 'opcoes':
            menuItems = [
                { text: 'Sair', href: '#', icon: 'fas fa-sign-out-alt', action: handleLogout }
            ];
            break;
        case 'clientes':
            menuItems = [
                { text: 'Cadastrar Cliente', href: 'pages/clientes/cadastro.html', icon: 'fas fa-user-plus' },
                { text: 'Meus Clientes', href: 'pages/clientes/listagem.html', icon: 'fas fa-users' }
            ];
            break;
        case 'agendamentos':
            menuItems = [
                { text: 'Cadastrar Agendamento', href: 'pages/agendamentos/cadastro.html', icon: 'fas fa-calendar-plus' },
                { text: 'Meus Agendamentos', href: 'pages/agendamentos/listagem.html', icon: 'fas fa-calendar-alt' }
            ];
            break;
        case 'procedimentos':
            menuItems = [
                { text: 'Cadastrar Procedimento', href: 'pages/procedimentos/cadastro.html', icon: 'fas fa-tools' }
            ];
            break;
        case 'extras':
            menuItems = [
                { text: 'Dashboard', href: 'pages/dashboard/dashboard.html', icon: 'fas fa-chart-line' },
                { text: 'Calendário', href: 'pages/calendario/calendario.html', icon: 'fas fa-calendar' },
                { text: 'Cadastrar Tarefa', href: 'pages/tarefas/cadastro.html', icon: 'fas fa-tasks' }
            ];
            break;
    }

    // Adiciona os itens ao menu flutuante
    menuItems.forEach(item => {
        const link = document.createElement('a');
        link.innerHTML = `<i class="${item.icon}"></i> ${item.text}`;
        link.href = item.href;
        if (item.action) {
            link.addEventListener('click', item.action);
        } else {
            link.onclick = function (event) {
                event.preventDefault();
                document.getElementById('content-frame').src = item.href;
                closeFloatingMenu(); // Fecha o menu após clicar
            };
        }
        floatingMenu.appendChild(link);
    });

    // Adiciona o manipulador de evento para fechar o menu ao clicar fora
    document.removeEventListener('click', handleClickOutsideMenu); // Remove qualquer listener existente para evitar duplicação
    setTimeout(() => { // Usa um pequeno delay para garantir que o clique do botão de módulo não feche o menu imediatamente
        document.addEventListener('click', handleClickOutsideMenu);
    }, 0);
}

// Função para logout
function handleLogout(event) {
    event.preventDefault();
    localStorage.removeItem('authToken');
    window.location.href = '/login';
}

// Função para fechar o menu flutuante ao clicar fora dele ou ao clicar novamente no botão de módulo
function handleClickOutsideMenu(event) {
    if (!floatingMenu.contains(event.target) && !event.target.classList.contains('module-btn')) {
        closeFloatingMenu();
    }
}

// Função para fechar o menu flutuante e redefinir o módulo aberto
function closeFloatingMenu() {
    floatingMenu.style.display = 'none';
    currentOpenModule = null; // Redefine o módulo aberto
    document.removeEventListener('click', handleClickOutsideMenu); // Remove o manipulador após ser executado
}
</script>
</body>
</html>
